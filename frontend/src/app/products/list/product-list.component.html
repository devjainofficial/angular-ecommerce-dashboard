<div class="flex flex-wrap justify-between items-center gap-4 mb-6">
  <h1 class="text-2xl font-bold text-gray-800">Products</h1>
  <div class="flex items-center gap-2">
    <label for="sortBy" class="text-sm font-medium text-gray-700">Sort by:</label>
    <select id="sortBy" [(ngModel)]="sortBy" (change)="onSortChange(sortBy)" class="border rounded px-2 py-1">
      <option value="name">Name</option>
      <option value="price">Price</option>
    </select>
    <select [(ngModel)]="sortDir" (change)="onSortDirChange(sortDir)" class="border rounded px-2 py-1">
      <option value="asc">Ascending</option>
      <option value="desc">Descending</option>
    </select>
  </div>
  <div class="flex flex-wrap items-center gap-4 w-full sm:w-auto">
    <div class="flex-1 sm:flex-none min-w-[12rem] max-w-xs">
      <product-filter
        [search]="filterText"
        (filterChange)="onFilterChange($event)">
      </product-filter>
    </div>

    <a routerLink="/products/new"
       class="flex-shrink-0 bg-blue-600 text-white text-sm font-medium px-4 py-2 rounded-md hover:bg-blue-700 transition">
      + Add Product
    </a>
  </div>
</div>

<div *ngIf="loading" class="flex justify-center items-center py-8">
  <svg class="animate-spin h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
  </svg>
  <span class="ml-3 text-blue-600 text-lg">Loading...</span>
</div>

<div *ngIf="products.length; else empty">
  <div class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
    <product-card
      *ngFor="let product of products"
      [product]="product"
      (edit)="edit($event)"
      (delete)="delete($event)">
    </product-card>
  </div>
  <div class="flex justify-center items-center gap-4 mt-8">
    <button (click)="prevPage()" [disabled]="pageIndex === 1" class="px-4 py-2 rounded bg-gray-200 disabled:opacity-50">Previous</button>
    <span>Page {{ pageIndex }}</span>
    <button (click)="nextPage()" [disabled]="isLastPage" class="px-4 py-2 rounded bg-gray-200 disabled:opacity-50">Next</button>
  </div>
</div>

<ng-template #empty>
  <div class="text-center text-gray-500 py-16">
    <p class="text-lg font-medium mb-2">No products found.</p>
    <p class="text-sm">Try changing the search or filters.</p>
  </div>
</ng-template>

<app-modal
  *ngIf="showModal"
  [message]="'Are you sure you want to delete ' + (productToDelete?.name || 'this product') + '?'"
  (confirm)="confirmDelete()"
  (cancel)="closeModal()"
></app-modal>
